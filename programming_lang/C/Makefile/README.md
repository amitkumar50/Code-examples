## Makefile or makefile or GNUMakefile

https://www3.ntu.edu.sg/home/ehchua/programming/cpp/gcc_make.html#zz-2.

### A. STRUCTURE OF Makefile
   - makefile consists of a set of `RULES`.
      - Rules consists of 3 parts 
         a. Target: target and pre-requisites are separated by a colon (:)
         b. List of pre-requisites 
         c. A command: The command must be preceded by a tab (NOT spaces)
```
target: pre-req-1 pre-req-2 ...
	command
```

### SECTIONS IN MAKEFILE
1. **Target** Anything preceding `:`. Can be name of
   a. File that is generated by makefile. Examples: Object files, executables.
   b. Action to carry out, such as `clean'(Phony target)
```
target .. : dependencies ..
            command
```
   - Types of targets
       - all: Either you can build a particular target (Eg: make file.o) or complete solution using (all)
       - Phony Target?  Not real name of a file. Name for a recipe to be executed when you make an explicit request. Example: clean
2. **Dependency** File that used to as input to create target. Examples: source code file etc
3. ***Rules*** commands needed to make the target
   - Types of Rules
     a. Explicit Rules
     b. Implicit Rules
4. **Comments**     
5. **Directives** ex: include, override
6. **Commmands** Action that make carries out
   
- **Example**
   - targets
      - `hello-exe` depends on 2 object files(called Dependencies)
      - `main.o` depends on 1 header and 1 source file(called Dependencies)
      - `clean` is name of an action.  Note that this rule not only is not a dependency, it also does not have any dependencies, so the only purpose of the rule is to run the specified commands
```
hello-exe : main.o test.o 
        cc -o edit main.o kbd.o command.o display.o \
                   insert.o search.o files.o utils.o
main.o : main.c defs.h                                   //target = main.o
        cc -c main.c
test.o : test.c defs.h
        cc -c test.c
clean :
        rm hello-exe main.o test.o
```

### Meanings in Makefile
- **PHONY target** not real name of a file, it is just a name for a recipe to be executed.
- **.PRECIOUS** 
  - if make is killed or interrupted during the execution of their recipes, the target is not deleted. 
  - Also, if the target is an intermediate file, it will not be deleted after it is no longer needed
  - Basically, .PRECIOUS to preserve intermediate files.
- **include** Suspend reading current Makefile and read other makefile before continuing.
- **override**: This is for setting the variable. Example: (override variable = value)
- **$(call variable,param1,param2,…)** Used for creating function(named variable) with parameters(param1,param2..)
   - Here BOOST_CHECK variable is assigned to function.
- **User variables** Defined by Users. Examples:
   - CPPFLAGS
   - LDLIBS: flags to give to compilers when they are supposed to invoke the linker, ld , such as -L . Libraries ( -lfoo ) should be added to the LDLIBS.
   
  
### SPECIAL CHARACTERS

| character | Name | Meaning |
| --- | --- | --- |
| @ | Silent | @rm means rm will be executed but silently ie not output on screen |
| $@ | Target | name of the file being generated |
| $% | | target member name. When target is foo.a(bar.o) ‘$%’ is bar.o |
| := | | Simple assignment. Example `CC :=${GCC} ${FLAGS}` is expanded to `gcc -W` |
| $< | Source file | |
| $^ | Pre-requisites | The names of all the prerequisites, with spaces between them |

### SWITCHES
| switch | Name | Meaning |
| --- | --- | --- |
| -Dmacro | Predefine name| (#man gcc) option Predefine name as a macro, with definition 1 |
| -O | Optimize | (#man gcc) Can have values 1,2,3,4 |
| -g | Debugging info | (#man gcc) Produce debugging information. -g0:no debug |

### FILES

| Extension | Meaning |
| --- | --- |
| .d | Dependency file contains make dependencies(which are automatically detected). Header files which are required for C/C++ source file are added into this |
