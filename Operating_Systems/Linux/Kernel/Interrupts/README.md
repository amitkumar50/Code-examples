- [Interrupt](#i)
- [Types of Interrupt](#t)
  - [1. Hardware, Software Interrupt](#hs)
  - [2. Vectored & Non Vectored](#vn)
  - [3. Maskable & Non Maskable Interrupts](#mn)
  - [4. Precise & Imprecise Interrupts](#pi)
- [Source of Interrupt](#sr)
- [Interrupt Flow/Hardware Interrupt reaching CPU](#if)

<a name=i></a>
## Interrupt
- Interrupt is event generated by hardware(I/O Device) which is sent to CPU by Interrupt Controller. CPU is asked to perform some high priority task wrt what its doing.
- Information from interrupt(eg: key pressed) is converted to character and stored in buffer to be later used by ISR. 

<a name=t></a>
## Types of Interrupts
<a name=hs></a>
### 1. Hardware, Software Interrupt
#### a. Hardware
Caused by signal from H/W. Examples: Key press on keyboard, mouse movement, timers
#### b. Software? 
Originated in software(process in user mode), CPU need to switch to kernel mode. Generated using system calls: 
```c
open(), socket()
trap() //also used by gdb
abort(): Program error eg: divide by 0, access invalid memory address.
```
**Making software Interrupt?**
```asm
  mov rax,4    ;Store system-call number in rax register
  mov rbx,arg1    ;Store arguments of system-call in rbx,rcx,rdx,rsi,rdp registers
  mov rcx,arg2
  int 0x80        ;Call S/W Interrupt. Just call int function with Interrupt number.    //As int is called Control Reaches IVT, Interrupt Vector table
```        

<a name=vn></a>
### 2. Vectored & Non Vectored
- *a. Vectored?* The interrupts which have fixed address location ie ISR to be executed on occurence of Interrupt.
- *b. Non Vectored?* The interrupts which does not have fixed address location for ISR to be executed at occurence

<a name=mn></a>
### 3. Maskable & Non Maskable Interrupts
  - *a. Maskable?* Interrupt handling can be delayed by CPU for some time. Eg: H/W device generating a interrupt.
  - *b. Non Maskable(NMI)?* Interrupts which cannot be ignored by CPU and need to be processed immediately. Eg: Hardware error.

<a name=pi></a>
### 4. Precise & Imprecise Interrupts
  - *a. Precise?* This interrupt that leaves the machine in a well-defined state. 4 properties of precise interrupts:
    - *1.* The [PC (Program Counter)](/Motherboard/CPU/Memory/CPU_Registers/User_Accessible_Registers) is saved and PC is made to point to new ISR. [PSW](/Motherboard/CPU/Memory/CPU_Registers/User_Accessible_Registers) must not be modified.
    - *2.* All instructions before the one pointed to by the PC have completed.
    - *3.* No instruction beyond the one pointed to by the PC has finished.
    - *4.* The execution state of the instruction pointed to by the PC is known.
  - *b. Imprecise?* Interrupts have completed in parts.
    - *Disadvantages of Imprecise Interrupts:*
      - *1.* The code for handling imprecise is exceedingly complex.
      - *2.* Huge stacks are created contaning information of all states.
      - *3.* Slow system, saving a large amount of information to memory on every interrupt makes interrupts slow and recovery even worse.

<img src=precise_imprecise_interrupts.JPG width=500 />

<a name=sr></a>
## Sources of Interrupt
- **1. Hardware / IO Devices:** 8259(PIC) sends interrupt signal on NMI or INTR inupt pins of 8086.
- **2. Software / Special Intruction in Software:** int(interrupt instruction) in program. See above.
- **3. Software / Condition produced in program:** some condition produced in the program by the execution of an instruction. Eg: Divide by 0.  

<a name=if></a>
## Interrupt Flow/Hardware Interrupt reaching CPU
- User is watching a movie and presses key on keyboard(hardware device).
- Hardware device/Periheral generates H/W Interrupt sends to [Interrupt Controller-8952 on IR0-IR7 lines](/Motherboard/8952_PIC). IC decides priority of Interrupt and forwards to CPU on [INTR(Interrupt) PIN](/Motherboard/CPU/Microprocessors/8086).
- CPU stops what it is doing and does the [following](Things_CPU_does_after_getting_Interrupt.md).
- Finds [ISR(Interrupt Service Routine/Interrupt Handler)](ISR.md) from [IVT(Interrupt Vector Table)](IVT), executes ISR. After completing the ISR resumes the task what it was doing.
<img src="./interrupt.jpg" width=1000 />


- [High Number of Interrupts](High_No_of_Interrupts.md)
- [Interrupt Numbers](Interrupt_Numbers.md)
- [/proc/interrupts and /proc/stat](/Operating_Systems/Linux/FileSystem/FileSystem_Tree/proc/): How many interrupts have been delivered to each CPU. Total interrupts received on System.
